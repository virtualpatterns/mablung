'use strict';

var _restify = require('restify');

var _restify2 = _interopRequireDefault(_restify);

var _restifyPlugins = require('restify-plugins');

var _restifyPlugins2 = _interopRequireDefault(_restifyPlugins);

var _configuration = require('../configuration');

var _configuration2 = _interopRequireDefault(_configuration);

var _index = require('../index');

var _path = require('../library/path');

var _path2 = _interopRequireDefault(_path);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var REGEXP_STATIC = /^\/www\/(.*)$/;

_index.Log.createFormattedLog(_configuration2.default.server.logPath);

var server = _restify2.default.createServer();

server.on('restifyError', function (request, response, error, callback) {
  _index.Log.error('server.on(\'restifyError\', (request, response, error, callback) => { ... })');
  _index.Log.error(error);
  return callback();
});

server.use(function (request, response, next) {
  _index.Log.debug(request.method + ' ' + request.url);
  return next();
});

server.get('/favicon.ico', function (request, response, next) {
  _restifyPlugins2.default.serveStatic({
    'directory': _path2.default.join(__dirname, '..', 'www', 'resources'),
    'file': 'application.ico',
    'maxAge': 0
  })(request, response, next);
});

server.get('/', function (request, response, next) {
  response.redirect('/www/index.html', next);
});

server.get('/www', function (request, response, next) {
  response.redirect('/www/index.html', next);
});

server.get(REGEXP_STATIC, function (request, response, next) {
  _restifyPlugins2.default.serveStatic({
    'directory': _path2.default.join(__dirname, '..', 'www'),
    'file': request.params[0],
    'maxAge': 0
  })(request, response, next);
});

server.listen(_configuration2.default.server.port, _configuration2.default.server.address, function () {
  _index.Log.debug('server.listen(' + _configuration2.default.server.port + ', \'' + _configuration2.default.server.address + '\', () => { ... })');
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9zZXJ2ZXIvaW5kZXguanMiXSwibmFtZXMiOlsiUkVHRVhQX1NUQVRJQyIsImNyZWF0ZUZvcm1hdHRlZExvZyIsInNlcnZlciIsImxvZ1BhdGgiLCJjcmVhdGVTZXJ2ZXIiLCJvbiIsInJlcXVlc3QiLCJyZXNwb25zZSIsImVycm9yIiwiY2FsbGJhY2siLCJ1c2UiLCJuZXh0IiwiZGVidWciLCJtZXRob2QiLCJ1cmwiLCJnZXQiLCJzZXJ2ZVN0YXRpYyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJyZWRpcmVjdCIsInBhcmFtcyIsImxpc3RlbiIsInBvcnQiLCJhZGRyZXNzIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUNBOztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxnQkFBZ0IsZUFBdEI7O0FBRUEsV0FBSUMsa0JBQUosQ0FBdUIsd0JBQWNDLE1BQWQsQ0FBcUJDLE9BQTVDOztBQUVBLElBQU1ELFNBQVMsa0JBQUtFLFlBQUwsRUFBZjs7QUFFQUYsT0FBT0csRUFBUCxDQUFVLGNBQVYsRUFBMEIsVUFBQ0MsT0FBRCxFQUFVQyxRQUFWLEVBQW9CQyxLQUFwQixFQUEyQkMsUUFBM0IsRUFBd0M7QUFDaEUsYUFBSUQsS0FBSixDQUFVLDhFQUFWO0FBQ0EsYUFBSUEsS0FBSixDQUFVQSxLQUFWO0FBQ0EsU0FBT0MsVUFBUDtBQUNELENBSkQ7O0FBTUFQLE9BQU9RLEdBQVAsQ0FBVyxVQUFDSixPQUFELEVBQVVDLFFBQVYsRUFBb0JJLElBQXBCLEVBQTZCO0FBQ3RDLGFBQUlDLEtBQUosQ0FBYU4sUUFBUU8sTUFBckIsU0FBK0JQLFFBQVFRLEdBQXZDO0FBQ0EsU0FBT0gsTUFBUDtBQUNELENBSEQ7O0FBS0FULE9BQU9hLEdBQVAsQ0FBVyxjQUFYLEVBQTJCLFVBQUNULE9BQUQsRUFBVUMsUUFBVixFQUFvQkksSUFBcEIsRUFBNkI7QUFDdEQsMkJBQVlLLFdBQVosQ0FBd0I7QUFDdEIsaUJBQWEsZUFBS0MsSUFBTCxDQUFVQyxTQUFWLEVBQXFCLElBQXJCLEVBQTJCLEtBQTNCLEVBQWtDLFdBQWxDLENBRFM7QUFFdEIsWUFBUSxpQkFGYztBQUd0QixjQUFVO0FBSFksR0FBeEIsRUFJR1osT0FKSCxFQUlZQyxRQUpaLEVBSXNCSSxJQUp0QjtBQUtELENBTkQ7O0FBUUFULE9BQU9hLEdBQVAsQ0FBVyxHQUFYLEVBQWdCLFVBQUNULE9BQUQsRUFBVUMsUUFBVixFQUFvQkksSUFBcEIsRUFBNkI7QUFDM0NKLFdBQVNZLFFBQVQsQ0FBa0IsaUJBQWxCLEVBQXFDUixJQUFyQztBQUNELENBRkQ7O0FBSUFULE9BQU9hLEdBQVAsQ0FBVyxNQUFYLEVBQW1CLFVBQUNULE9BQUQsRUFBVUMsUUFBVixFQUFvQkksSUFBcEIsRUFBNkI7QUFDOUNKLFdBQVNZLFFBQVQsQ0FBa0IsaUJBQWxCLEVBQXFDUixJQUFyQztBQUNELENBRkQ7O0FBSUFULE9BQU9hLEdBQVAsQ0FBV2YsYUFBWCxFQUEwQixVQUFDTSxPQUFELEVBQVVDLFFBQVYsRUFBb0JJLElBQXBCLEVBQTZCO0FBQ3JELDJCQUFZSyxXQUFaLENBQXdCO0FBQ3RCLGlCQUFhLGVBQUtDLElBQUwsQ0FBVUMsU0FBVixFQUFxQixJQUFyQixFQUEyQixLQUEzQixDQURTO0FBRXRCLFlBQVFaLFFBQVFjLE1BQVIsQ0FBZSxDQUFmLENBRmM7QUFHdEIsY0FBVTtBQUhZLEdBQXhCLEVBSUdkLE9BSkgsRUFJWUMsUUFKWixFQUlzQkksSUFKdEI7QUFLRCxDQU5EOztBQVFBVCxPQUFPbUIsTUFBUCxDQUFjLHdCQUFjbkIsTUFBZCxDQUFxQm9CLElBQW5DLEVBQXlDLHdCQUFjcEIsTUFBZCxDQUFxQnFCLE9BQTlELEVBQXVFLFlBQU07QUFDM0UsYUFBSVgsS0FBSixvQkFBMkIsd0JBQWNWLE1BQWQsQ0FBcUJvQixJQUFoRCxZQUEwRCx3QkFBY3BCLE1BQWQsQ0FBcUJxQixPQUEvRTtBQUNELENBRkQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUkVTVCBmcm9tICdyZXN0aWZ5J1xuaW1wb3J0IFJFU1RQbHVnaW5zIGZyb20gJ3Jlc3RpZnktcGx1Z2lucydcblxuaW1wb3J0IENvbmZpZ3VyYXRpb24gZnJvbSAnLi4vY29uZmlndXJhdGlvbidcbmltcG9ydCB7IExvZyB9IGZyb20gJy4uL2luZGV4J1xuaW1wb3J0IFBhdGggZnJvbSAnLi4vbGlicmFyeS9wYXRoJ1xuXG5jb25zdCBSRUdFWFBfU1RBVElDID0gL15cXC93d3dcXC8oLiopJC9cblxuTG9nLmNyZWF0ZUZvcm1hdHRlZExvZyhDb25maWd1cmF0aW9uLnNlcnZlci5sb2dQYXRoKVxuXG5jb25zdCBzZXJ2ZXIgPSBSRVNULmNyZWF0ZVNlcnZlcigpXG5cbnNlcnZlci5vbigncmVzdGlmeUVycm9yJywgKHJlcXVlc3QsIHJlc3BvbnNlLCBlcnJvciwgY2FsbGJhY2spID0+IHtcbiAgTG9nLmVycm9yKCdzZXJ2ZXIub24oXFwncmVzdGlmeUVycm9yXFwnLCAocmVxdWVzdCwgcmVzcG9uc2UsIGVycm9yLCBjYWxsYmFjaykgPT4geyAuLi4gfSknKVxuICBMb2cuZXJyb3IoZXJyb3IpXG4gIHJldHVybiBjYWxsYmFjaygpXG59KVxuXG5zZXJ2ZXIudXNlKChyZXF1ZXN0LCByZXNwb25zZSwgbmV4dCkgPT4ge1xuICBMb2cuZGVidWcoYCR7cmVxdWVzdC5tZXRob2R9ICR7cmVxdWVzdC51cmx9YClcbiAgcmV0dXJuIG5leHQoKVxufSlcblxuc2VydmVyLmdldCgnL2Zhdmljb24uaWNvJywgKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0KSA9PiB7XG4gIFJFU1RQbHVnaW5zLnNlcnZlU3RhdGljKHtcbiAgICAnZGlyZWN0b3J5JzogUGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ3d3dycsICdyZXNvdXJjZXMnKSxcbiAgICAnZmlsZSc6ICdhcHBsaWNhdGlvbi5pY28nLFxuICAgICdtYXhBZ2UnOiAwXG4gIH0pKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0KVxufSlcblxuc2VydmVyLmdldCgnLycsIChyZXF1ZXN0LCByZXNwb25zZSwgbmV4dCkgPT4ge1xuICByZXNwb25zZS5yZWRpcmVjdCgnL3d3dy9pbmRleC5odG1sJywgbmV4dClcbn0pXG5cbnNlcnZlci5nZXQoJy93d3cnLCAocmVxdWVzdCwgcmVzcG9uc2UsIG5leHQpID0+IHtcbiAgcmVzcG9uc2UucmVkaXJlY3QoJy93d3cvaW5kZXguaHRtbCcsIG5leHQpXG59KVxuXG5zZXJ2ZXIuZ2V0KFJFR0VYUF9TVEFUSUMsIChyZXF1ZXN0LCByZXNwb25zZSwgbmV4dCkgPT4ge1xuICBSRVNUUGx1Z2lucy5zZXJ2ZVN0YXRpYyh7XG4gICAgJ2RpcmVjdG9yeSc6IFBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICd3d3cnKSxcbiAgICAnZmlsZSc6IHJlcXVlc3QucGFyYW1zWzBdLFxuICAgICdtYXhBZ2UnOiAwXG4gIH0pKHJlcXVlc3QsIHJlc3BvbnNlLCBuZXh0KVxufSlcblxuc2VydmVyLmxpc3RlbihDb25maWd1cmF0aW9uLnNlcnZlci5wb3J0LCBDb25maWd1cmF0aW9uLnNlcnZlci5hZGRyZXNzLCAoKSA9PiB7XG4gIExvZy5kZWJ1Zyhgc2VydmVyLmxpc3Rlbigke0NvbmZpZ3VyYXRpb24uc2VydmVyLnBvcnR9LCAnJHtDb25maWd1cmF0aW9uLnNlcnZlci5hZGRyZXNzfScsICgpID0+IHsgLi4uIH0pYClcbn0pXG4iXX0=